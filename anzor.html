<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê—Ä–µ–Ω–¥–∞ –ú–æ—Ç–æ</title>
  
  <style>
    body {
      background-color: #121212;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container { max-width: 480px; width: 100%; }
    input, button {
      margin: 10px 0;
      padding: 14px;
      width: 100%;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    input { background-color: #1e1e1e; color: #fff; }
    input::placeholder { color: #bbb; }
    button {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .record {
      border: 1px solid #333;
      margin-top: 12px;
      padding: 14px;
      background-color: #1e1e1e;
      border-radius: 6px;
    }
    .record-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .record-buttons button {
      margin-right: 8px;
      padding: 6px 12px;
      font-size: 14px;
    }
    .extra-info {
      font-size: 14px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üèç –ê—Ä–µ–Ω–¥–∞ –ú–æ—Ç–æ</h1>
    <input type="text" id="name" placeholder="–ò–º—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞">
    <input type="text" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
    <input type="number" id="hours" placeholder="–ß–∞—Å—ã –∞—Ä–µ–Ω–¥—ã" min="0">
<input type="number" id="minutes" placeholder="–ú–∏–Ω—É—Ç—ã –∞—Ä–µ–Ω–¥—ã" min="0" max="59">
    <button onclick="addRecord()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <div id="records"></div>
  </div>
  <script>
    
    // Firebase —É–¥–∞–ª—ë–Ω ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–æ–π –±–∞–∑–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å
// –ü—Ä–∏–º–µ—Ä: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É (localStorage) –∏–ª–∏ API

    function addRecord() {
  
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const hours = parseInt(document.getElementById('hours').value) || 0;
  const minutes = parseInt(document.getElementById('minutes').value) || 0;

  if (!name || !phone || (hours === 0 && minutes === 0)) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.');
    return;
  }

  const duration = (hours * 60 + minutes) * 60000;

  saveRecord({
    name,
    phone,
    duration,
    startTime: Date.now(),
    isPaused: false,
    notified: false
  })
  .then(() => {
    console.log("–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ Firestore.");
    document.getElementById('name').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('hours').value = '';
    document.getElementById('minutes').value = '';
  })
  .catch((error) => {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏:", error);
    alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.");
  });
}

function loadRecords() {
  const records = JSON.parse(localStorage.getItem('arenda') || '[]');
  const container = document.getElementById('records');
  container.innerHTML = '';
  records.forEach((rec, index) => createRecordElement(index.toString(), rec));
}

    function createRecordElement(id, rec) {
      const div = document.createElement('div');
      div.className = 'record';

      const header = document.createElement('div');
      header.className = 'record-header';
      header.innerHTML = `<strong>${rec.name}</strong><span>üìû ${rec.phone}</span>`;

      const timer = document.createElement('p');
      const extra = document.createElement('p');
      extra.className = 'extra-info';

      const buttons = document.createElement('div');
      buttons.className = 'record-buttons';

      const startStopBtn = document.createElement('button');
      const deleteBtn = document.createElement('button');

      deleteBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
      deleteBtn.onclick = () => deleteRecord(id);

      let interval;
      function updateTimer() {
        const now = Date.now();
        if (!rec.startTime) {
          timer.textContent = '‚èπ –ù–µ –∑–∞–ø—É—â–µ–Ω–æ';
          extra.textContent = '';
          return;
        }

        if (!rec.isPaused) {
          const passed = now - rec.startTime;
          const left = rec.duration - passed;

          if (left <= 0) {
            const overtime = -left;
            const h = Math.floor(overtime / 3600000);
            const m = Math.floor((overtime % 3600000) / 60000);
            const s = Math.floor((overtime % 60000) / 1000);
            timer.textContent = '‚è∞ –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ!';
            extra.textContent = `–ó–∞–¥–µ—Ä–∂–∫–∞: ${h}—á ${m}–º ${s}—Å`;

            if (!rec.notified) {
              markAsNotified(id)
              rec.notified = true;
            }
          } else {
            const h = Math.floor(left / 3600000);
            const m = Math.floor((left % 3600000) / 60000);
            const s = Math.floor((left % 60000) / 1000);
            timer.textContent = `‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: ${h}—á ${m}–º ${s}—Å`;
            extra.textContent = '';
          }
        } else {
          const h = Math.floor(rec.duration / 3600000);
          const m = Math.floor((rec.duration % 3600000) / 60000);
          const s = Math.floor((rec.duration % 60000) / 1000);
          timer.textContent = `‚è∏ –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${h}—á ${m}–º ${s}—Å`;
          extra.textContent = '';
        }
      }

      startStopBtn.textContent = rec.isPaused ? '‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç' : '‚è∏ –°—Ç–æ–ø';
      updateTimer();
      interval = setInterval(updateTimer, 1000);
      startStopBtn.onclick = () => {
        const now = Date.now();
        if (rec.isPaused) {
          resumeRecord(id, now)
        } else {
          const passed = now - rec.startTime;
          const remaining = Math.max(0, rec.duration - passed);
          pauseRecord(id, remaining)
        }
      };

      updateTimer();

      buttons.appendChild(startStopBtn);
      buttons.appendChild(deleteBtn);

      div.appendChild(header);
      div.appendChild(timer);
      div.appendChild(extra);
      div.appendChild(buttons);
      document.getElementById('records').appendChild(div);
    }

    loadRecords();
  function saveRecord(record) {
  const records = JSON.parse(localStorage.getItem('arenda') || '[]');
  records.push(record);
  localStorage.setItem('arenda', JSON.stringify(records));
  loadRecords();
}

function deleteRecord(id) {
  const records = JSON.parse(localStorage.getItem('arenda') || '[]');
  records.splice(parseInt(id), 1);
  localStorage.setItem('arenda', JSON.stringify(records));
  loadRecords();
}

function markAsNotified(id) {
  const records = JSON.parse(localStorage.getItem('arenda') || '[]');
  records[parseInt(id)].notified = true;
  localStorage.setItem('arenda', JSON.stringify(records));
}

function resumeRecord(id, now) {
  const records = JSON.parse(localStorage.getItem('arenda') || '[]');
  records[parseInt(id)].startTime = now;
  records[parseInt(id)].isPaused = false;
  localStorage.setItem('arenda', JSON.stringify(records));
  loadRecords();
}

function pauseRecord(id, remaining) {
  const records = JSON.parse(localStorage.getItem('arenda') || '[]');
  records[parseInt(id)].duration = remaining;
  records[parseInt(id)].isPaused = true;
  records[parseInt(id)].startTime = null;
  localStorage.setItem('arenda', JSON.stringify(records));
  loadRecords();
}

window.addRecord = addRecord;
</script>
</body>
</html>
